{% extends "base.html" %}

{% block styles %}
<style>
    /* 响应式表格样式 */
    @media (max-width: 992px) {
        /* 小屏幕设备表格样式 */
        .table-responsive {
            overflow-x: auto;
        }
    }
    
    /* 表格风格优化 */
    .table thead th {
        position: sticky;
        top: 0;
        background-color: #f8f9fa;
        z-index: 2;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-2 px-md-3 px-lg-4">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3 mb-md-4">
        <h2 class="mb-2 mb-md-0 fs-4 fs-md-3">查看周报</h2>
        <div class="action-buttons">
            <a href="{{ url_for('work_report.weekly') }}" class="btn btn-secondary me-md-2 mb-2 mb-md-0">
                <i class="fas fa-arrow-left"></i> <span class="d-none d-sm-inline">返回周报列表</span>
            </a>
            <a href="{{ url_for('work_report.weekly_edit', report_id=report.id) }}" class="btn btn-warning">
                <i class="fas fa-edit"></i> <span class="d-none d-sm-inline">编辑周报</span>
            </a>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0 fs-5">{{ report.start_date.year }}年 第{{ report.week_number }}周 部门周报 ({{ report.start_date }} 至 {{ report.end_date }})</h5>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-6 mb-2">
                    <strong>会议时间：</strong> {{ report.meeting_time.strftime('%Y-%m-%d') if report.meeting_time else '未设置' }}
                </div>
                <div class="col-md-6 mb-2">
                    <strong>会议地点：</strong> {{ report.meeting_place or '未设置' }}
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-6 mb-2">
                    <strong>主持人：</strong> {{ report.host or '未设置' }}
                </div>
                <div class="col-md-6 mb-2">
                    <strong>参会人员：</strong> {{ report.participants or '未设置' }}
                </div>
            </div>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0 fs-5">一、重点工作跟进/风险工作通报</h5>
        </div>
        <div class="card-body">
            {% if key_works %}
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th width="3%">序号</th>
                            <th width="8%">责任人</th>
                            <th width="18%">工作内容</th>
                            <th width="15%">目标完成结果</th>
                            <th width="10%">时间节点</th>
                            <th width="8%">是否完成</th>
                            <th width="15%">执行结果检查</th>
                            <th width="12%">拟采取措施</th>
                            <th width="8%">预计完成时间</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for work in key_works %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ work.person }}</td>
                            <td>{{ work.content }}</td>
                            <td>{{ work.target }}</td>
                            <td>{{ work.timeline }}</td>
                            <td>{{ work.completed }}</td>
                            <td>{{ work.check }}</td>
                            <td>{{ work.measures }}</td>
                            <td>{{ work.expected_date }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted">暂无重点工作记录</p>
            {% endif %}
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0 fs-5">二、临时性工作安排</h5>
        </div>
        <div class="card-body">
            {% if report.temp_works %}
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th width="3%">序号</th>
                            <th width="8%">责任人</th>
                            <th width="18%">工作内容</th>
                            <th width="15%">目标完成结果</th>
                            <th width="10%">时间节点</th>
                            <th width="8%">是否完成</th>
                            <th width="15%">执行结果检查</th>
                            <th width="12%">拟采取措施</th>
                            <th width="8%">预计完成时间</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for work in report.temp_works %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ work.person }}</td>
                            <td>{{ work.content }}</td>
                            <td>{{ work.target }}</td>
                            <td>{{ work.timeline }}</td>
                            <td>{{ work.completed }}</td>
                            <td>{{ work.check }}</td>
                            <td>{{ work.measures }}</td>
                            <td>{{ work.expected_date }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted">暂无临时性工作记录</p>
            {% endif %}
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0 fs-5">三、协同事项/协调资源/需要决策事项</h5>
        </div>
        <div class="card-body">
            {% if report.coordinations %}
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th width="3%">序号</th>
                            <th width="8%">责任人</th>
                            <th width="18%">工作内容</th>
                            <th width="15%">目标完成结果</th>
                            <th width="10%">时间节点</th>
                            <th width="8%">是否完成</th>
                            <th width="15%">执行结果检查</th>
                            <th width="12%">拟采取措施</th>
                            <th width="8%">预计完成时间</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for work in report.coordinations %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ work.person }}</td>
                            <td>{{ work.content }}</td>
                            <td>{{ work.target }}</td>
                            <td>{{ work.timeline }}</td>
                            <td>{{ work.completed }}</td>
                            <td>{{ work.check }}</td>
                            <td>{{ work.measures }}</td>
                            <td>{{ work.expected_date }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted">暂无协调工作记录</p>
            {% endif %}
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0 fs-5">四、会议达成共识事项/领导指示与建议</h5>
        </div>
        <div class="card-body">
            {% if report.consensus %}
            <div class="card-text">
                {{ report.consensus|nl2br|safe }}
            </div>
            {% else %}
            <p class="text-muted">暂无会议达成共识事项/领导指示与建议</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %} 